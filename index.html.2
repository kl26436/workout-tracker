<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0d1117">
    <title>Big Surf - Workout Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <img src="BigSurf.png" alt="Big Surf Logo" class="logo-img" 
                 onerror="this.style.display='none'; document.querySelector('.logo-fallback').style.display='flex'">
            <div class="logo-fallback" style="display: none;">BS</div>
        </header>

        <!-- Auth Section -->
        <div id="auth-section" class="workout-controls">
            <button id="google-signin-btn" class="btn btn-primary">
                <i class="fab fa-google"></i> Sign In with Google
            </button>
            <div id="user-info" class="hidden"></div>
        </div>

        <!-- Today's Date Display -->
        <div class="today-header">
            <h2 id="today-date-display">Today - Loading...</h2>
            <p class="today-subtitle">Choose your workout and start tracking</p>
            
            <!-- Enhanced Management Buttons -->
            <div style="margin-top: 1rem;">
                <button class="btn btn-secondary" onclick="showWorkoutHistory()" style="margin-right: 0.5rem;">
                    <i class="fas fa-history"></i> Workout History
                </button>
                <button class="btn btn-secondary" onclick="showWorkoutManagement()" style="margin-right: 0.5rem;">
                    <i class="fas fa-cog"></i> Manage Workouts
                </button>
                <button class="btn btn-secondary" onclick="showWorkoutSelector()" id="back-to-workouts-btn" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Back to Workouts
                </button>
            </div>
        </div>

        <!-- Enhanced Workout Selector with Template Selection -->
        <div id="workout-selector">
            <div class="workout-type-header">
                <h3>Choose Workout Type</h3>
                <p>Select a workout category, then choose your specific template</p>
            </div>
            
            <div class="workout-grid" id="workout-type-grid">
                <!-- Workout types will be populated here -->
            </div>
            
            <!-- Template Selection Modal -->
            <div id="template-selection-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="template-modal-title" class="modal-title">Choose Template</h3>
                        <button class="close-btn" onclick="closeTemplateSelection()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="template-selection-grid" id="template-selection-grid">
                        <!-- Templates will be populated here -->
                    </div>
                    
                    <div class="template-selection-actions">
                        <button class="btn btn-primary" onclick="createTemplateForType()">
                            <i class="fas fa-plus"></i> Create New Template
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Workout -->
        <div id="active-workout" class="hidden">
            <!-- Global Settings -->
            <div class="global-settings">
                <div>
                    <span style="color: var(--text-secondary); font-size: 0.875rem;">Default Units:</span>
                    <div class="unit-toggle">
                        <button class="unit-btn active" data-unit="lbs">lbs</button>
                        <button class="unit-btn" data-unit="kg">kg</button>
                    </div>
                </div>
            </div>

            <!-- Workout Header -->
            <div class="workout-header">
                <div class="workout-info">
                    <h3 id="current-workout-title">Current Workout</h3>
                    <div class="workout-meta" id="workout-meta">Started now</div>
                </div>
                <div class="workout-actions">
                    <span id="completed-progress" style="color: var(--text-secondary); margin-right: 1rem;">0/0</span>
                    <button class="btn" id="change-workout-btn">
                        <i class="fas fa-exchange-alt"></i> Change
                    </button>
                    <button class="btn btn-primary" id="finish-workout-btn">
                        <i class="fas fa-check"></i> Finish
                    </button>
                </div>
            </div>

            <!-- Exercise List -->
            <div id="exercise-list" class="exercise-list"></div>
        </div>

        <!-- Workout Management Section -->
        <div id="workout-management" class="hidden">
            <div class="management-header">
                <h2>Workout Management</h2>
                <div class="management-actions">
                    <button class="btn btn-secondary" onclick="showWorkoutSelector()">
                        <i class="fas fa-arrow-left"></i> Back to Workouts
                    </button>
                    <button class="btn btn-primary" onclick="showCreateTemplateModal()">
                        <i class="fas fa-plus"></i> New Template
                    </button>
                </div>
            </div>

            <!-- Template Categories -->
            <div class="template-categories">
                <div class="category-tabs">
                    <button class="category-tab active" data-category="default" onclick="switchTemplateCategory('default')">
                        <i class="fas fa-star"></i> Default Templates
                    </button>
                    <button class="category-tab" data-category="custom" onclick="switchTemplateCategory('custom')">
                        <i class="fas fa-user"></i> My Templates
                    </button>
                </div>
                
                <div class="category-content">
                    <div id="default-templates" class="template-grid">
                        <!-- Default templates will be loaded here -->
                    </div>
                    <div id="custom-templates" class="template-grid hidden">
                        <!-- Custom templates will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- =====================================================================
             WORKOUT HISTORY SECTION (BUG-008, BUG-009, BUG-010 fixes)
             ===================================================================== -->
        <div id="workout-history-section" class="hidden">
            <div class="history-header">
                <h2>Workout History</h2>
                <div class="history-actions">
                    <button class="btn btn-secondary" onclick="showWorkoutSelector()">
                        <i class="fas fa-arrow-left"></i> Back to Workouts
                    </button>
                    <button class="btn btn-success" onclick="showAddManualWorkoutModal()">
                        <i class="fas fa-plus"></i> Add Past Workout
                    </button>
                </div>
            </div>

            <!-- History Stats -->
            <div id="history-stats" class="history-stats">
                <!-- Stats will be populated here -->
            </div>

            <!-- =====================================================================
                 HISTORY FILTERS (BUG-009, BUG-010 fixes)
                 ===================================================================== -->
            <div class="history-filters">
                <div class="filter-section">
                    <h4>Filter by Status</h4>
                    <div class="filter-buttons">
                        <button class="history-filter-btn active" data-filter="all">All</button>
                        <button class="history-filter-btn" data-filter="completed">Completed</button>
                        <button class="history-filter-btn" data-filter="cancelled">Cancelled</button>
                        <button class="history-filter-btn" data-filter="discarded">Discarded</button>
                    </div>
                </div>

                <div class="filter-section">
                    <h4>Filter by Time</h4>
                    <div class="filter-buttons">
                        <button class="history-filter-btn" data-filter="this-week">This Week</button>
                        <button class="history-filter-btn" data-filter="this-month">This Month</button>
                    </div>
                </div>

                <div class="filter-section">
                    <h4>Search & Date Range</h4>
                    <div class="search-filters">
                        <input type="text" id="history-search" class="form-input" 
                               placeholder="Search workouts, dates, notes...">
                        <input type="date" id="history-start-date" class="form-input" title="Start Date">
                        <input type="date" id="history-end-date" class="form-input" title="End Date">
                        <button class="btn btn-secondary btn-small" onclick="clearHistoryFilters()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- History List -->
            <div id="workout-history-list" class="workout-history-list">
                <!-- Workout history cards will be populated here -->
            </div>

            <!-- Pagination -->
            <div id="history-pagination" class="history-pagination">
                <!-- Pagination will be populated here -->
            </div>
        </div>
    </div>

    <!-- =====================================================================
         STICKY REST TIMER
         ===================================================================== -->
    <div id="rest-timer-sticky" class="rest-timer-sticky">
        <div class="rest-timer-content">
            <div class="rest-timer-exercise" id="rest-timer-exercise">Rest Period</div>
            <div class="rest-timer-display" id="rest-timer-display">90s</div>
            <div class="rest-timer-controls">
                <button class="btn btn-small" id="pause-rest-btn">
                    <i class="fas fa-pause"></i>
                </button>
                <button class="btn btn-small" id="skip-rest-btn">
                    <i class="fas fa-forward"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- =====================================================================
         EXERCISE FOCUS MODAL WITH VIDEO SUPPORT
         ===================================================================== -->
    <div id="exercise-modal" class="exercise-modal">
        <div class="exercise-modal-content">
            <div class="modal-header">
                <h3 id="modal-exercise-title">Exercise</h3>
                <button class="close-btn" id="close-exercise-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Exercise Video Section -->
            <div id="exercise-video-section" class="exercise-video-section hidden">
                <div class="video-container">
                    <iframe id="exercise-video-iframe" width="100%" height="315" frameborder="0" allowfullscreen></iframe>
                </div>
                <button class="btn btn-secondary btn-small" onclick="hideExerciseVideo()">
                    <i class="fas fa-eye-slash"></i> Hide Video
                </button>
            </div>
            
            <div class="exercise-unit-toggle">
                <div class="unit-toggle">
                    <button class="unit-btn active" data-unit="lbs">lbs</button>
                    <button class="unit-btn" data-unit="kg">kg</button>
                </div>
            </div>
            
            <div id="modal-exercise-content"></div>
        </div>
    </div>

    <!-- =====================================================================
         ADD MANUAL WORKOUT MODAL (BUG-007, BUG-011 fixes)
         ===================================================================== -->
    <div id="add-manual-workout-modal" class="modal hidden">
        <div class="modal-content manual-workout-modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Past Workout</h3>
                <button class="close-btn" onclick="closeAddManualWorkoutModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Step 1: Basic Workout Info -->
            <div id="manual-step-1" class="manual-step">
                <form id="manual-workout-basic-form">
                    <div class="form-group">
                        <label for="manual-workout-date">Workout Date *</label>
                        <input type="date" id="manual-workout-date" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="manual-workout-category">Workout Category *</label>
                        <select id="manual-workout-category" class="form-input" required>
                            <option value="">Select a category...</option>
                            <option value="Push">Push (Chest, Shoulders, Triceps)</option>
                            <option value="Pull">Pull (Back, Biceps)</option>
                            <option value="Legs">Legs (Quads, Glutes, Hamstrings)</option>
                            <option value="Cardio">Cardio & Core</option>
                            <option value="Other">Other/Mixed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="manual-workout-name">Workout Name</label>
                        <input type="text" id="manual-workout-name" class="form-input" 
                               placeholder="e.g., Chest & Triceps, Upper Body, etc.">
                    </div>

                    <div class="form-group">
                        <label for="manual-workout-duration">Duration (minutes)</label>
                        <input type="number" id="manual-workout-duration" class="form-input" 
                               placeholder="60" min="1" max="300">
                    </div>

                    <div class="form-group">
                        <label for="manual-workout-status">Status</label>
                        <select id="manual-workout-status" class="form-input">
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="manual-workout-notes">Notes</label>
                        <textarea id="manual-workout-notes" class="form-input" rows="3" 
                                  placeholder="Any notes about performance, feeling, etc."></textarea>
                    </div>

                    <div class="step-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAddManualWorkoutModal()">
                            Cancel
                        </button>
                        <button type="button" class="btn btn-primary" onclick="proceedToExerciseSelection()">
                            Next: Add Exercises <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Step 2: Exercise Selection and Data Entry -->
            <div id="manual-step-2" class="manual-step hidden">
                <div class="step-header">
                    <button class="btn btn-secondary btn-small" onclick="backToBasicInfo()">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <div class="step-info">
                        <h4 id="manual-workout-title-display">Your Workout</h4>
                        <p id="manual-workout-date-display">Date</p>
                    </div>
                    <button class="btn btn-success" onclick="finishManualWorkout()">
                        <i class="fas fa-check"></i> Save Workout
                    </button>
                </div>

                <!-- Exercise Management -->
                <div class="manual-exercise-management">
                    <div class="exercise-management-header">
                        <h4>
                            <i class="fas fa-dumbbell"></i> 
                            Exercises (<span id="manual-exercise-count">0</span>)
                        </h4>
                        <!-- BUG-007 FIX: Add Exercise button for manual workouts -->
                        <button class="btn btn-primary btn-small" onclick="addExerciseToManualWorkout()">
                            <i class="fas fa-plus"></i> Add Exercise
                        </button>
                    </div>

                    <!-- Exercise List -->
                    <div id="manual-exercises-container" class="manual-exercises-container">
                        <div class="no-exercises-state">
                            <i class="fas fa-plus-circle"></i>
                            <h5>No Exercises Added</h5>
                            <p>Click "Add Exercise" to start building your workout</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- =====================================================================
         MANUAL EXERCISE ENTRY MODAL (BUG-011 fix)
         ===================================================================== -->
    <div id="manual-exercise-entry-modal" class="exercise-modal">
        <div class="exercise-modal-content">
            <div class="modal-header">
                <h3 id="manual-exercise-title">Exercise</h3>
                <button class="close-btn" onclick="closeManualExerciseEntry()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="exercise-unit-toggle">
                <div class="unit-toggle">
                    <button class="unit-btn active" data-unit="lbs">lbs</button>
                    <button class="unit-btn" data-unit="kg">kg</button>
                </div>
            </div>
            
            <div id="manual-exercise-content">
                <!-- Exercise table will be populated here -->
            </div>
            
            <!-- BUG-011 FIX: Save button for manual exercise entry -->
            <div class="modal-actions" style="padding: 1rem; border-top: 1px solid var(--border);">
                <button class="btn btn-secondary" onclick="closeManualExerciseEntry()">
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="saveManualExerciseEntry()">
                    <i class="fas fa-check"></i> Save Exercise
                </button>
            </div>
        </div>
    </div>

    <!-- =====================================================================
         EXERCISE LIBRARY MODAL (BUG-007 fix)
         ===================================================================== -->
    <div id="exercise-library-modal" class="modal hidden">
        <div class="modal-content exercise-library-content">
            <div class="modal-header">
                <h3 class="modal-title">Exercise Library</h3>
                <button class="close-btn" onclick="closeExerciseLibrary()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Search and Filters -->
            <div class="exercise-search">
                <input type="text" id="exercise-search-input" class="form-input" 
                       placeholder="Search exercises..." onkeyup="searchExerciseLibraryForManual()">
            </div>
            
            <div class="library-filters">
                <div class="filter-row">
                    <select id="body-part-filter" class="form-input">
                        <option value="">All Body Parts</option>
                        <option value="Chest">Chest</option>
                        <option value="Back">Back</option>
                        <option value="Shoulders">Shoulders</option>
                        <option value="Arms">Arms</option>
                        <option value="Legs">Legs</option>
                        <option value="Core">Core</option>
                    </select>
                    <select id="equipment-filter" class="form-input">
                        <option value="">All Equipment</option>
                        <option value="Machine">Machine</option>
                        <option value="Dumbbell">Dumbbell</option>
                        <option value="Barbell">Barbell</option>
                        <option value="Bodyweight">Bodyweight</option>
                        <option value="Cable">Cable</option>
                    </select>
                </div>
            </div>
            
            <!-- Exercise Grid -->
            <div id="exercise-library-content" class="exercise-library-grid">
                <!-- Exercises will be populated here -->
            </div>
            
            <!-- Actions -->
            <div class="exercise-library-actions">
                <button class="btn btn-secondary" onclick="closeExerciseLibrary()">Cancel</button>
                <button class="btn btn-primary" onclick="showCreateExerciseForManual()">Create New Exercise</button>
            </div>
        </div>
    </div>

    <!-- =====================================================================
         CREATE EXERCISE MODAL
         ===================================================================== -->
    <div id="create-exercise-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Exercise</h3>
                <button class="close-btn" onclick="closeCreateExerciseModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="create-exercise-form">
                <div class="form-group">
                    <label for="new-exercise-name">Exercise Name *</label>
                    <input type="text" id="new-exercise-name" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label for="new-exercise-body-part">Body Part</label>
                    <select id="new-exercise-body-part" class="form-input">
                        <option value="Chest">Chest</option>
                        <option value="Back">Back</option>
                        <option value="Shoulders">Shoulders</option>
                        <option value="Arms">Arms</option>
                        <option value="Legs">Legs</option>
                        <option value="Core">Core</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="new-exercise-equipment">Equipment Type</label>
                    <select id="new-exercise-equipment" class="form-input">
                        <option value="Machine">Machine</option>
                        <option value="Dumbbell">Dumbbell</option>
                        <option value="Barbell">Barbell</option>
                        <option value="Bodyweight">Bodyweight</option>
                        <option value="Cable">Cable</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="new-exercise-video">Video URL (optional)</label>
                    <input type="url" id="new-exercise-video" class="form-input" 
                           placeholder="https://youtube.com/watch?v=...">
                </div>
                
                <div class="step-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateExerciseModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create Exercise
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- =====================================================================
         TEMPLATE EDITOR MODAL
         ===================================================================== -->
    <div id="template-editor-modal" class="modal hidden">
        <div class="modal-content template-editor-content">
            <div class="modal-header">
                <h3 id="template-editor-title" class="modal-title">Create Workout Template</h3>
                <button class="close-btn" onclick="closeTemplateEditor()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="template-editor-body">
                <!-- Template info and exercise editor will be populated here -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
   <script type="module" src="js/main.js"></script>
</body>
</html>